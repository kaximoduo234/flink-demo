version: '3.8'

services:
  # ğŸš« JobManager - æ— å¥åº·æ£€æŸ¥
  jobmanager:
    image: custom-flink:1.20.1-paimon-optimized
    container_name: no-health-jobmanager
    ports:
      - "8081:8081"
      - "6123:6123"
    command: jobmanager
    environment:
      - |
        FLINK_PROPERTIES=
        jobmanager.rpc.address: jobmanager
        taskmanager.numberOfTaskSlots: 4
        parallelism.default: 1
        jobmanager.memory.process.size: 1g
    volumes:
      - ./paimon-warehouse:/warehouse
    # ğŸš« å¥åº·æ£€æŸ¥å·²æ³¨é‡Š
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:8081"]
    #   interval: 3s
    #   timeout: 2s
    #   retries: 2
    #   start_period: 8s

  # ğŸš« TaskManager - æ— ä¾èµ–ç­‰å¾…
  taskmanager:
    image: custom-flink:1.20.1-paimon-optimized
    container_name: no-health-taskmanager
    # ğŸš« ä¾èµ–å·²æ³¨é‡Š - å¹¶è¡Œå¯åŠ¨
    # depends_on:
    #   jobmanager:
    #     condition: service_healthy
    command: taskmanager
    environment:
      - |
        FLINK_PROPERTIES=
        jobmanager.rpc.address: jobmanager
        taskmanager.numberOfTaskSlots: 4
        parallelism.default: 1
        taskmanager.memory.process.size: 1g
    volumes:
      - ./paimon-warehouse:/warehouse

  # ğŸš« SQL Gateway - æ— ä¾èµ–ç­‰å¾…
  sql-gateway:
    image: custom-flink:1.20.1-paimon-optimized
    container_name: no-health-sql-gateway
    # ğŸš« ä¾èµ–å·²æ³¨é‡Š - å¹¶è¡Œå¯åŠ¨
    # depends_on:
    #   jobmanager:
    #     condition: service_healthy
    command: ["bin/sql-gateway.sh", "start-foreground"]
    ports:
      - "8083:8083"
    environment:
      - |
        FLINK_PROPERTIES=
        sql-gateway.endpoint.rest.address: 0.0.0.0
        sql-gateway.endpoint.rest.port: 8083
        execution.target: remote
        jobmanager.rpc.address: jobmanager
        rest.address: jobmanager
        rest.port: 8081
        parallelism.default: 1 